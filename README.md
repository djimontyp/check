# Check service

### Запуск проекту:

Для запуску проекту потрібно:
1. Підняти docker compose
2. Підтянути фікстури принтерів

---

### Опис роботи сервісу:

**1. Сервіс для обробки замовлення:**

- [x] Отримує інформацію про нове замовлення.
- [x] Створює в базі даних (БД) чеки для всіх принтерів точки, зазначеної в замовленні.
- [x] Розміщує асинхронні завдання на генерацію PDF-файлів для цих чеків.
- [x] Повертає помилку, якщо точка не має жодного принтера.
- [x] Повертає помилку, якщо чеки для цього замовлення вже були створені.(передається номер замовлення)

**2. Асинхронний воркер:**

- [x] Використовує wkhtmltopdf для генерації PDF-файлу з HTML-шаблону.
- [x] Назва файлу має бути у форматі <ID замовлення>_<тип чека>.pdf (наприклад, 123456_client.pdf).
- [x] Файли зберігаються в папці media/pdf у корені проекту.

**3. Програма для опитування сервісу:**

- [x] Опитує сервіс на наявність нових чеків.
- [x] Запитує список чеків, які вже були згенеровані для конкретного принтера.
- [x] Завантажує PDF-файл для кожного чека.
- [x] Відправляє кожен PDF-файл на друк.
- [x] Змінює статус чеку після друку.

### Моделі:

1. **Модель "Printer"**
    
    | Поле       | Тип          |    Значення    | Опис                              |
    |------------|--------------|:--------------:|-----------------------------------|
    | name       | CharField    |                | Назва принтеру                    |
    | api_key    | CharField    |                | Ключ доступу до API               |
    | check_type | CharField    | kitchen/client | Тип чеку який друкує принтер      |
    | point_id   | IntegerField |                | Точка до якої прив'язаний принтер |
    
    - [x] Кожен принтер друкує лише свій тип чеків.
    - [x] Поле `api_key` набуває унікальних значень, по ньому однозначно визначається принтер.
    - [x] Для цієї моделі повинні бути `fixtures` (принтери для обох типів чеків для кількох точок).
   
2. **Модель "Check"**
    
    | Поле       | Тип        |       Значення       | Опис                            |
    |------------|------------|:--------------------:|---------------------------------|
    | printer_id | ForeignKey |                      | Принтер                         |
    | type       | CharField  |    kitchen/client    | Тип чеку                        |
    | order      | JSONField  |                      | Інформація про замовлення       |
    | status     | CharField  | new/rendered/printed | Статус чеку                     |
    | pdf_file   | FileField  |                      | Посилання на створений PDF-файл |

   - [x] Для цієї моделі повинні бути `fixtures` (принтери для обох типів чеків для кількох точок).

### API:
    
- [x] Опис доступних методів міститься у файлі api.yml (swagger-специфікація).
